# 命令编辑器完成度分析

生成时间: 2026-01-13

## 命令类型清单

基于 `CommandType` 枚举和实际使用的命令类型：

### ✅ 已完成编辑器和渲染器

| 命令类型 | 编辑器 | 渲染器 | 备注 |
|---------|--------|--------|------|
| dialogue | ✅ DialogueEditor | ✅ DialogueRenderer | 对话 |
| message | ✅ DialogueEditor | ✅ DialogueRenderer | 消息（复用dialogue） |
| narration | ✅ DialogueEditor | ✅ DialogueRenderer | 旁白（复用dialogue） |
| fade | ✅ FadeEditor | ✅ FadeRenderer | 淡入淡出 |
| actormotion | ✅ ActorMotionEditor | ✅ ActorMotionRenderer | 角色动作 |
| actorfacialmotion | ✅ ActorFacialMotionEditor | ✅ ActorFacialMotionRenderer | 角色表情 |
| backgroundsetting | ✅ BackgroundSettingEditor | ✅ BackgroundSettingRenderer | 2D背景设置 |
| camerasetting | ✅ CameraSettingEditor | ✅ CameraSettingRenderer | 相机设置 |
| backgroundgroup | ✅ BackgroundItemEditor（子项编辑） | ✅ BackgroundGroupRenderer | 背景组 - 模式二 |
| actorgroup | ✅ ActorItemEditor（子项编辑） | ✅ ActorGroupRenderer | 角色组 - 模式二 |
| actorlayoutgroup | ✅ ActorLayoutItemEditor（子项编辑） | ✅ ActorLayoutGroupRenderer | 角色布局组 - 模式二 |
| backgroundlayoutgroup | ✅ BackgroundLayoutGroupItemEditor（子项编辑） | ✅ BackgroundLayoutGroupRenderer | 3D背景布局组 - 模式二 |
| actorfacialoverridemotion | ❌ | ✅ ActorFacialOverrideMotionRenderer | 表情覆盖动作 |
| actorlooktarget | ❌ | ✅ ActorLookTargetRenderer | 视线目标 |
| transition | ✅ TransitionEditor | ✅ TransitionRenderer | 场景过渡（带条件验证） |

### ❌ 缺少编辑器和渲染器

| 命令类型 | 缺少内容 | 优先级 | 复杂度 | 建议 |
|---------|---------|--------|--------|------|
| choicegroup | 编辑器 + 渲染器 | 🔴 高 | 中 | 模式二（Group类），需要编辑多个choice项 |
| voice | 编辑器 + 渲染器 | 🟡 中 | 低 | 模式一（简单参数），类似actormotion |
| bgmplay | 编辑器 + 渲染器 | 🟡 中 | 低 | 模式一（简单参数），类似voice |
| bgmstop | 编辑器 + 渲染器 | 🟢 低 | 低 | 模式一（无参数） |
| se | 编辑器 + 渲染器 | 🟡 中 | 低 | 模式一（简单参数），类似voice |
| shake | 编辑器 + 渲染器 | 🟢 低 | 中 | 模式一或模式三，需确认参数结构 |
| dof | 编辑器 + 渲染器 | 🟢 低 | 中 | 模式一或模式三，需确认参数结构 |
| coloreffect | 编辑器 + 渲染器 | 🟢 低 | 中 | 模式一或模式三，需确认参数结构 |
| timeline | 编辑器 + 渲染器 | 🟢 低 | 未知 | 需确认用途和参数结构 |
| actoradditivemotion | 编辑器 + 渲染器 | 🟢 低 | 低 | 模式一，类似actormotion |
| actorlooktargettween | 编辑器 + 渲染器 | 🟢 低 | 低 | 模式一，类似actorlooktarget |
| actoreyeblink | 编辑器 + 渲染器 | 🟢 低 | 低 | 模式一，简单参数 |
| actorlighting | 编辑器 + 渲染器 | 🟢 低 | 中 | 模式一或模式三，需确认参数结构 |

**注意**：`actor`、`background`、`actorlayout` 等不是独立命令，它们是 Group 命令的子项，通过 Group 命令的编辑器编辑，不单独统计。

### ⚠️ 只有渲染器，缺少专用编辑器

| 命令类型 | 当前状态 | 建议操作 |
|---------|---------|---------|
| actorfacialoverridemotion | 使用GenericEditor | 实现专用编辑器（模式一） |
| actorlooktarget | 使用GenericEditor | 实现专用编辑器（模式一） |

### 📊 统计

- **独立命令类型**: 27 种（排除 actor、background、actorlayout、backgroundlayout 等子项命令）
- **已完成编辑器**: 15 种（含模式二的 4 个 Group 子项编辑器 + transition）
- **只有渲染器**: 0 种
- **完全缺失**: 12 种
- **完成度**: 56% (15/27)

**说明**：
- 只统计脚本中以 `[xxx]` 形式出现的独立命令
- `actor`、`background`、`actorlayout` 等子项命令不单独统计，它们通过所属 Group 命令编辑
- 模式二（Group 类）命令通过子项编辑器实现，功能完整

## 优先级建议

### 第一优先级（高频使用，影响大）
1. **choicegroup** - 选项组，剧情分支必需
2. **voice** - 语音，大部分对话都有
3. **bgmplay / bgmstop** - 背景音乐控制
4. **se** - 音效

### 第二优先级（常用但可用GenericEditor临时替代）
5. **actorfacialoverridemotion** - 已有渲染器，补充编辑器
6. **actorlooktarget** - 已有渲染器，补充编辑器
7. **shake** - 震动效果

### 第三优先级（低频或效果增强）
9. **dof** - 景深效果
10. **coloreffect** - 色彩效果
11. **actoradditivemotion** - 叠加动作
12. **actorlooktargettween** - 视线目标过渡
13. **actoreyeblink** - 眨眼控制
14. **actorlighting** - 角色光照
15. **timeline** - 时间轴（需确认用途）

## 下一步行动

### 立即行动（高性价比）

1. **voice 编辑器** - 参考 actormotion 实现
   - 模式一，简单参数
   - 从 Database API 获取语音列表
   - 预计耗时: 30分钟

2. **bgmplay/bgmstop 编辑器** - 类似 voice
   - 模式一，简单参数
   - 从 Database API 获取BGM列表
   - 预计耗时: 30分钟

3. **se 编辑器** - 类似 voice
   - 模式一，简单参数
   - 从 Database API 获取SE列表
   - 预计耗时: 30分钟

4. **choicegroup 编辑器** - 复杂度较高
   - 模式二，Group类命令
   - 需要解析和编辑多个 choice 项
   - 参考 backgroundgroup 实现
   - 预计耗时: 2小时

### 快速补充渲染器（已有GenericEditor的）

5. **actorfacialoverridemotion 编辑器**
   - 模式一，简单参数
   - 预计耗时: 20分钟

6. **actorlooktarget 编辑器**
   - 模式一，简单参数
   - 预计耗时: 20分钟

7. ~~**transition 编辑器**~~ ✅ 已完成
   - 需确认参数结构
   - 预计耗时: 30-60分钟

## 技术笔记

### 模式分类参考

- **模式一（简单参数）**: voice, bgmplay, se, actoradditivemotion, actoreyeblink, actorlooktargettween
- **模式二（Group类）**: choicegroup
- **模式三（复杂JSON）**: shake(?), dof(?), coloreffect(?), actorlighting(?)
- **待确认**: transition, timeline

### Database API 支持

需要确认 Database API 是否提供以下资源：
- ✅ 角色动作 (motions)
- ✅ 2D背景 (backgrounds)
- ❓ 语音文件 (voices)
- ❓ BGM列表 (bgm)
- ❓ SE列表 (se)

如果 API 不支持，可以降级到文本输入（参考 actormotion 的实现）。
