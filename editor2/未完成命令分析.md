# 未完成命令分析与实现计划

> 📋 本文档列出所有尚未实现专用编辑器的命令，以及推荐的实现模式。  
> 📅 创建时间: 2026-01-13  
> 🔄 状态: 基于命令编辑器开发规范

---

## 目录

1. [已实现命令总览](#已实现命令总览)
2. [待实现命令分类](#待实现命令分类)
3. [优先级排序](#优先级排序)
4. [实现计划](#实现计划)

---

## 已实现命令总览

### ✅ 完全实现（11个）

| 命令类型 | 编辑器 | 实现模式 | 状态 |
|---------|--------|----------|------|
| `dialogue` / `message` / `narration` | DialogueEditor | 模式一 + FormEditor | ✅ 完成 |
| `fade` | FadeEditor | 模式一（简化） | ✅ 完成 |
| `transition` | TransitionEditor | 模式一 + 条件参数 | ✅ 完成 |
| `actormotion` | ActorMotionEditor | 模式一 + DB API | ✅ 完成 |
| `actorfacialmotion` | ActorFacialMotionEditor | 模式一 + DB API | ✅ 完成 |
| `backgroundsetting` | BackgroundSettingEditor | 模式三 + VectorInput | ✅ 完成 |
| `camerasetting` | CameraSettingEditor | 模式三 + FormEditor | ✅ 完成 |
| `backgroundgroup` | BackgroundItemEditor | 模式二 | ✅ 完成 |
| `actorgroup` | ActorItemEditor | 模式二 | ✅ 完成 |
| `actorlayoutgroup` | ActorLayoutItemEditor | 模式二 + VectorInput | ✅ 完成 |
| `backgroundlayoutgroup` | BackgroundLayoutGroupItemEditor | 模式二（只读） | ✅ 完成 |

**当前使用 GenericEditor（通用编辑器）的所有其他命令**

---

## 待实现命令分类

### 🔴 优先级 1 - 高频使用命令（建议优先实现）

#### 1. ChoiceGroup - 选项分支

**命令格式：**
```
[choicegroup choices=[choice title=选项1 dest=label1] [choice title=选项2 dest=label2]]
```

**推荐实现：**
- **模式：** 模式二（Group 项编辑器）
- **子项编辑器：** ChoiceItemEditor
- **字段：** title（文本）, dest（标签）
- **特点：** 类似 backgroundgroup，但更简单

**实现难度：** ⭐⭐ 低

---

#### 2. Voice - 语音播放

**命令格式：**
```
[voice id=角色ID name=语音文件名]
```

**推荐实现：**
- **模式：** 模式一（高级）
- **依赖：** useAvailableActorIds
- **字段：** 
  - id（下拉选择，从 actorgroup）
  - name（文本输入，或从 DB API 获取语音列表）
- **特点：** 类似 actormotion，但可能需要新的 DB API

**实现难度：** ⭐⭐⭐ 中

---

#### 3. ActorFacialOverrideMotion - 表情覆盖

**命令格式：**
```
[actorfacialoverridemotion id=角色ID motion=表情名称]
```

**推荐实现：**
- **模式：** 直接复用 ActorResourceEditor
- **配置：** 
```typescript
<ActorResourceEditor 
  config={{ 
    resourceType: 'facial',  
    resourceLabel: '覆盖表情'
  }} 
/>
```

**实现难度：** ⭐ 非常低（几乎零代码）

---

### 🟡 优先级 2 - 中频使用命令

#### 4. Shake - 震动效果

**命令格式：**
```
[shake intensity=0.5 duration=0.3]
```

**推荐实现：**
- **模式：** 模式一（简单）+ FormEditor
- **字段：** 
  - intensity（数字，范围 0-1）
  - duration（数字，秒）
- **特点：** 类似 fade，非常简单

**实现难度：** ⭐ 非常低

---

#### 5. BgmPlay - 背景音乐播放

**命令格式：**
```
[bgmplay name=音乐文件名 volume=1.0 fadetime=0.5]
```

**推荐实现：**
- **模式：** 模式一 + FormEditor
- **字段：** 
  - name（文本或下拉，可选从 DB API）
  - volume（数字，范围 0-1）
  - fadetime（数字，秒）
- **特点：** 简单的表单编辑

**实现难度：** ⭐⭐ 低

---

#### 6. BgmStop - 背景音乐停止

**命令格式：**
```
[bgmstop fadetime=0.5]
```

**推荐实现：**
- **模式：** 模式一（简化）
- **字段：** fadetime（数字，秒）
- **特点：** 极简单，只有一个参数

**实现难度：** ⭐ 非常低

---

#### 7. Se - 音效播放

**命令格式：**
```
[se name=音效文件名 volume=1.0]
```

**推荐实现：**
- **模式：** 模式一 + FormEditor
- **字段：** 
  - name（文本）
  - volume（数字，范围 0-1）
- **特点：** 类似 bgmplay，更简单

**实现难度：** ⭐ 非常低

---

### 🟢 优先级 3 - 低频/高级命令

#### 8. ActorAdditiveMotion - 叠加动画

**命令格式：**
```
[actoradditivemotion id=角色ID motion=动作名称 weight=1.0]
```

**推荐实现：**
- **模式：** 复用 ActorResourceEditor + 额外字段
- **字段：** 
  - id（从 actorgroup）
  - motion（从 DB API character motions）
  - weight（数字，范围 0-1）

**实现难度：** ⭐⭐ 低（复用现有）

---

#### 9. ActorLookTarget - 角色注视目标

**命令格式：**
```
[actorlooktarget id=角色ID target=目标ID]
```

**推荐实现：**
- **模式：** 模式一
- **字段：** 
  - id（从 actorgroup）
  - target（从 actorgroup，或特殊值如 "camera"）
- **特点：** 需要两个角色 ID 下拉

**实现难度：** ⭐⭐ 低

---

#### 10. ActorLookTargetTween - 角色注视补间

**命令格式：**
```
[actorlooktargettween id=角色ID target=目标ID duration=0.5 easetype=0]
```

**推荐实现：**
- **模式：** 模式一 + FormEditor
- **字段：** 
  - id（从 actorgroup）
  - target（从 actorgroup）
  - duration（数字）
  - easetype（下拉选择）

**实现难度：** ⭐⭐ 低

---

#### 11. ActorEyeBlink - 眨眼动画

**命令格式：**
```
[actoreyeblink id=角色ID enable=true]
```

**推荐实现：**
- **模式：** 模式一（简化）
- **字段：** 
  - id（从 actorgroup）
  - enable（布尔值，checkbox）

**实现难度：** ⭐ 非常低

---

#### 12. ActorLighting - 角色光照

**命令格式：**
```
[actorlighting id=角色ID intensity=1.0 color={r:1,g:1,b:1}]
```

**推荐实现：**
- **模式：** 模式一 + FormEditor
- **字段：** 
  - id（从 actorgroup）
  - intensity（数字）
  - color（JSON 或颜色选择器）

**实现难度：** ⭐⭐⭐ 中（颜色 JSON 处理）

---

#### 13. Dof - 景深效果

**命令格式：**
```
[dof focusdistance=5.0 aperture=1.4 focallength=50]
```

**推荐实现：**
- **模式：** 模式一 + FormEditor
- **字段：** 
  - focusdistance（数字）
  - aperture（数字）
  - focallength（数字）

**实现难度：** ⭐⭐ 低

---

#### 14. ColorEffect - 颜色效果

**命令格式：**
```
[coloreffect type=sepia intensity=0.5]
```

**推荐实现：**
- **模式：** 模式一 + FormEditor
- **字段：** 
  - type（下拉：sepia, grayscale, etc.）
  - intensity（数字，0-1）

**实现难度：** ⭐⭐ 低

---

#### 15. Timeline - 时间轴（特殊）

**命令格式：**
```
[timeline name=时间轴名称]
```

**推荐实现：**
- **模式：** 特殊处理（可能不需要编辑器）
- **特点：** 这是一个控制命令，可能只需要简单的文本输入

**实现难度：** ⭐ 非常低

---

## 优先级排序

### 按实现价值排序

| 优先级 | 命令 | 使用频率 | 实现难度 | 收益 | 推荐顺序 |
|--------|------|---------|---------|------|---------|
| 🔴 | **ChoiceGroup** | 高 | 低 | 高 | 1 |
| 🔴 | **Voice** | 高 | 中 | 高 | 2 |
| 🔴 | **ActorFacialOverrideMotion** | 高 | 极低 | 高 | 3 |
| 🟡 | **Shake** | 中 | 极低 | 中 | 4 |
| 🟡 | **BgmPlay** | 中 | 低 | 中 | 5 |
| 🟡 | **BgmStop** | 中 | 极低 | 中 | 6 |
| 🟡 | **Se** | 中 | 极低 | 中 | 7 |
| 🟢 | **ActorEyeBlink** | 低 | 极低 | 低 | 8 |
| 🟢 | **ActorLookTarget** | 低 | 低 | 低 | 9 |
| 🟢 | **ActorAdditiveMotion** | 低 | 低 | 低 | 10 |
| 🟢 | **Dof** | 低 | 低 | 低 | 11 |
| 🟢 | **ColorEffect** | 低 | 低 | 低 | 12 |
| 🟢 | **ActorLookTargetTween** | 低 | 低 | 低 | 13 |
| 🟢 | **ActorLighting** | 低 | 中 | 低 | 14 |
| 🟢 | **Timeline** | 低 | 极低 | 低 | 15 |

---

## 实现计划

### 📦 快速实现包（预计 2-3 小时）

**适合一次性实现的简单命令：**

1. **ActorFacialOverrideMotion** - 零代码，复用 ActorResourceEditor
2. **Shake** - 仅 2 个数字字段
3. **BgmStop** - 仅 1 个数字字段
4. **Se** - 仅 2 个字段
5. **ActorEyeBlink** - 仅 2 个字段
6. **Dof** - 仅 3 个数字字段
7. **ColorEffect** - 仅 2 个字段
8. **Timeline** - 仅 1 个文本字段

**预计减少：** 约 8 个命令使用 GenericEditor → 专用编辑器

---

### 🎯 重点实现（需要单独开发）

#### 阶段 1: ChoiceGroup（最重要）
- 创建 ChoiceItemEditor
- 实现 Group 项编辑逻辑
- 添加渲染器
- **预计时间：** 2-3 小时

#### 阶段 2: Voice（需要 DB API）
- 可能需要扩展 Database API（语音列表）
- 使用 useResourceAPI
- 类似 actormotion 实现
- **预计时间：** 3-4 小时（含 API）

#### 阶段 3: 音频命令（BgmPlay）
- 简单的表单编辑
- 可选：添加 DB API 支持音乐列表
- **预计时间：** 1-2 小时

---

### 📊 完成后的覆盖率

**当前状态：**
- 已实现专用编辑器：11 个
- 使用通用编辑器：15 个
- **覆盖率：** 42%

**完成快速实现包后：**
- 已实现专用编辑器：19 个
- 使用通用编辑器：7 个
- **覆盖率：** 73%

**完成所有重点实现后：**
- 已实现专用编辑器：26 个
- 使用通用编辑器：0 个
- **覆盖率：** 100% ✅

---

## 实现指南速查

### 极简命令（1-2 个字段）

**模板：** 参考 `FadeEditor.tsx`

```typescript
export const YourEditor: React.FC<Props> = ({ card, onChange }) => {
  const [formData, setFormData] = useState({
    field1: card.params.field1 ?? defaultValue,
  });

  useEffect(() => {
    onChange({ ...card, params: formData }, true);
  }, [formData]);

  return (
    <div className="form-container">
      <div className="form-field">
        <label>字段名</label>
        <input 
          type="number" 
          value={formData.field1}
          onChange={(e) => setFormData({ ...formData, field1: parseFloat(e.target.value) })}
        />
      </div>
    </div>
  );
};
```

---

### FormEditor 命令（多个简单字段）

**模板：** 参考 `TransitionEditor.tsx`

```typescript
export const YourEditor: React.FC<Props> = ({ card, onChange }) => {
  const [formData, setFormData] = useState(card);

  const sections: FormSection[] = [
    {
      title: '基本设置',
      fields: [
        { name: 'field1', label: '字段1', type: 'text', value: formData.params.field1 || '' },
        { name: 'field2', label: '字段2', type: 'number', value: formData.params.field2 || 0 },
      ],
    },
  ];

  const handleFieldChange = (fieldName: string, value: any) => {
    const updatedCard = {
      ...formData,
      params: { ...formData.params, [fieldName]: value },
    };
    setFormData(updatedCard);
  };

  useEffect(() => {
    const isValid = formData.params.field1 !== '';
    onChange(formData, isValid);
  }, [formData]);

  return <FormEditor sections={sections} onChange={handleFieldChange} />;
};
```

---

### 复用 ActorResourceEditor

**模板：** 直接配置

```typescript
export const YourEditor: React.FC<Props> = (props) => (
  <ActorResourceEditor 
    {...props} 
    config={{ 
      resourceType: 'character' | 'facial',  
      resourceLabel: '资源名称',
      extraFields: [/* 可选的额外字段 */]
    }} 
  />
);
```

---

## 总结

- ✅ **已实现：** 11 个命令（42%）
- 🚧 **待实现：** 15 个命令（58%）
- 🎯 **建议优先：** ChoiceGroup, Voice, ActorFacialOverrideMotion
- 📦 **快速胜利：** 8 个简单命令可在 2-3 小时内完成
- 🏆 **最终目标：** 100% 覆盖率

---

📝 **文档版本**: v1.0  
📅 **最后更新**: 2026-01-13  
👤 **维护者**: Editor2 开发团队  
📖 **参考**: [命令编辑器开发规范](命令编辑器开发规范.md)
