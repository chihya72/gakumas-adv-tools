# å‘½ä»¤ç¼–è¾‘å™¨å¼€å‘è§„èŒƒ

> ğŸ“‹ æœ¬æ–‡æ¡£æ˜¯ Editor2 é¡¹ç›®çš„ç¼–è¾‘å™¨å¼€å‘è§„èŒƒï¼Œæ•´åˆäº†æ‰€æœ‰é‡æ„ç»éªŒå’Œæœ€ä½³å®è·µã€‚  
> ğŸ“… åˆ›å»ºæ—¶é—´: 2026-01-13  
> âœ… çŠ¶æ€: åŸºäºé˜¶æ®µ1-3å®Œæ•´é‡æ„ç»éªŒç¼–å†™

---

## ç›®å½•

1. [æ¶æ„æ¦‚è¿°](#æ¶æ„æ¦‚è¿°)
2. [åŸºç¡€è®¾æ–½ä½¿ç”¨æŒ‡å—](#åŸºç¡€è®¾æ–½ä½¿ç”¨æŒ‡å—)
3. [ç¼–è¾‘å™¨å¼€å‘ä¸‰å¤§æ¨¡å¼](#ç¼–è¾‘å™¨å¼€å‘ä¸‰å¤§æ¨¡å¼)
4. [å¼€å‘æµç¨‹è§„èŒƒ](#å¼€å‘æµç¨‹è§„èŒƒ)
5. [æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹](#æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹)
6. [ä»£ç å®¡æŸ¥æ¸…å•](#ä»£ç å®¡æŸ¥æ¸…å•)
7. [å¸¸è§é—®é¢˜è§£ç­”](#å¸¸è§é—®é¢˜è§£ç­”)

---

## æ¶æ„æ¦‚è¿°

### è®¾è®¡ç†å¿µ

Editor2 é‡‡ç”¨æ¨¡å—åŒ–ã€å¯å¤ç”¨çš„æ¶æ„è®¾è®¡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      App.tsx (ä¸»åº”ç”¨)                      â”‚
â”‚  - EditorContext çŠ¶æ€ç®¡ç†                                 â”‚
â”‚  - å¡ç‰‡åˆ—è¡¨ç®¡ç†                                           â”‚
â”‚  - ç¼–è¾‘å¯¹è¯æ¡†åè°ƒ                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Context    â”‚   â”‚    Hooks     â”‚   â”‚  Components  â”‚
â”‚              â”‚   â”‚              â”‚   â”‚              â”‚
â”‚ EditorContextâ”‚   â”‚useResourceAPIâ”‚   â”‚ LoadingState â”‚
â”‚              â”‚   â”‚useAvailableIdsâ”‚   â”‚ ErrorState   â”‚
â”‚              â”‚   â”‚              â”‚   â”‚ EmptyState   â”‚
â”‚              â”‚   â”‚              â”‚   â”‚ VectorInput  â”‚
â”‚              â”‚   â”‚              â”‚   â”‚ FormEditor   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¨¡å¼ä¸€ç¼–è¾‘å™¨  â”‚   â”‚ æ¨¡å¼äºŒç¼–è¾‘å™¨  â”‚   â”‚ æ¨¡å¼ä¸‰ç¼–è¾‘å™¨  â”‚
â”‚ DialogueEditorâ”‚   â”‚BackgroundGroupâ”‚   â”‚CameraSetting â”‚
â”‚ FadeEditor   â”‚   â”‚ActorGroup    â”‚   â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒåŸåˆ™

1. **ğŸš« ç¦æ­¢ä½¿ç”¨ window å¯¹è±¡** - å…¨éƒ¨ä½¿ç”¨ EditorContext
2. **â™»ï¸ æœ€å¤§åŒ–ä»£ç å¤ç”¨** - ä½¿ç”¨é€šç”¨ Hooks å’Œç»„ä»¶
3. **ğŸ“¦ ç»Ÿä¸€æ•°æ®è·å–** - ä½¿ç”¨ useResourceAPI
4. **ğŸ¨ ç»Ÿä¸€ UI ä½“éªŒ** - ä½¿ç”¨é€šç”¨çŠ¶æ€ç»„ä»¶
5. **âœ… ç±»å‹å®‰å…¨ä¼˜å…ˆ** - æ‰€æœ‰æ¥å£éƒ½æœ‰å®Œæ•´çš„ç±»å‹å®šä¹‰

---

## åŸºç¡€è®¾æ–½ä½¿ç”¨æŒ‡å—

### 1. EditorContext - çŠ¶æ€ç®¡ç†

**âŒ é”™è¯¯åšæ³•ï¼ˆç¦æ­¢ï¼‰ï¼š**
```typescript
// ä¸è¦ä½¿ç”¨ window å¯¹è±¡ï¼
const cards = (window as any).__editorCards;
```

**âœ… æ­£ç¡®åšæ³•ï¼š**
```typescript
import { useEditorContext } from '../../../context/EditorContext';

const YourEditor: React.FC<Props> = ({ card, onChange }) => {
  const { cards } = useEditorContext();
  // ä½¿ç”¨ cards
};
```

**å¯ç”¨çš„ Hooksï¼š**
- `useEditorContext()` - è·å–å®Œæ•´çš„ Contextï¼ˆcards, selectedCard, setSelectedCardï¼‰
- `useEditorCards()` - ä»…è·å– cards æ•°ç»„
- `useSelectedCard()` - ä»…è·å–é€‰ä¸­çš„å¡ç‰‡

---

### 2. useResourceAPI - ç»Ÿä¸€ API è°ƒç”¨

**ç”¨é€”ï¼š** ä» Database API åŠ è½½èµ„æºï¼ˆåŠ¨ä½œã€è¡¨æƒ…ã€ç¯å¢ƒã€æ¨¡å‹ç­‰ï¼‰

**æä¾›çš„ Hooksï¼š**

```typescript
// é€šç”¨ API è°ƒç”¨
const { data, loading, error, reload } = useResourceAPI<T>(endpoint);

// é¢„å®šä¹‰çš„ä¸“ç”¨ Hooks
const { data: motions, loading, error, reload } = useMotions('character' | 'facial');
const { data: environments, loading, error, reload } = useEnvironments();
const { data: models, loading, error, reload } = useModels(characterId, modelType);
const { data: characters, loading, error, reload } = useCharacters();
```

**æ ‡å‡†ä½¿ç”¨æ¨¡å¼ï¼š**
```typescript
export const YourEditor: React.FC<Props> = ({ card, onChange }) => {
  const { data: resources, loading, error, reload } = useMotions('character');

  // 1. æ˜¾ç¤ºåŠ è½½çŠ¶æ€
  if (loading) return <LoadingState message="åŠ è½½èµ„æºä¸­..." />;
  
  // 2. æ˜¾ç¤ºé”™è¯¯çŠ¶æ€ï¼ˆå¸¦é‡è¯•æŒ‰é’®ï¼‰
  if (error) return <ErrorState message="åŠ è½½å¤±è´¥" details={error} onRetry={reload} />;
  
  // 3. æ­£å¸¸æ¸²æŸ“
  return (
    <select>
      {resources.map(r => <option key={r.id} value={r.id}>{r.name}</option>)}
    </select>
  );
};
```

**ä¼˜åŠ¿ï¼š**
- âœ… è‡ªåŠ¨é”™è¯¯å¤„ç†
- âœ… ç»Ÿä¸€çš„é‡è¯•é€»è¾‘
- âœ… ç±»å‹å®‰å…¨
- âœ… æ˜“äºæ·»åŠ ç¼“å­˜

---

### 3. useAvailableIds - ç»Ÿä¸€ ID è·å–

**ç”¨é€”ï¼š** ä»å·²æœ‰çš„ Group å‘½ä»¤ä¸­æå–å¯ç”¨çš„ ID åˆ—è¡¨

**æä¾›çš„ Hooksï¼š**

```typescript
const availableActorIds = useAvailableActorIds();
// è¿”å›: string[] - æ‰€æœ‰ actorgroup ä¸­å®šä¹‰çš„è§’è‰² ID

const available2DBackgrounds = useAvailableBackgroundIds('2d');
const available3DBackgrounds = useAvailableBackgroundIds('3d');
// è¿”å›: string[] - æ‰€æœ‰ backgroundgroup ä¸­å®šä¹‰çš„èƒŒæ™¯ IDï¼ˆæ ¹æ®ç±»å‹ç­›é€‰ï¼‰
```

**æ ‡å‡†ä½¿ç”¨æ¨¡å¼ï¼š**
```typescript
export const YourEditor: React.FC<Props> = ({ card, onChange }) => {
  const availableActorIds = useAvailableActorIds();
  
  // æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨ ID
  if (availableActorIds.length === 0) {
    return (
      <EmptyState 
        title="æ— å¯ç”¨è§’è‰²" 
        description="è¯·å…ˆæ·»åŠ  actorgroup å‘½ä»¤æ¥å®šä¹‰è§’è‰²"
      />
    );
  }
  
  // æ­£å¸¸æ¸²æŸ“
  return (
    <select>
      {availableActorIds.map(id => <option key={id} value={id}>{id}</option>)}
    </select>
  );
};
```

**2D/3D èƒŒæ™¯åˆ¤æ–­å·¥å…·ï¼š**
```typescript
import { isBackground2D } from '../../../hooks/useAvailableIds';

const is2D = isBackground2D(backgroundSrc); // æ ¹æ®æ‰©å±•ååˆ¤æ–­
```

---

### 4. é€šç”¨ UI ç»„ä»¶

#### LoadingState - åŠ è½½çŠ¶æ€

```typescript
import { LoadingState } from '../../common';

<LoadingState message="åŠ è½½èµ„æºä¸­..." />
```

#### ErrorState - é”™è¯¯çŠ¶æ€ï¼ˆå¸¦é‡è¯•ï¼‰

```typescript
import { ErrorState } from '../../common';

<ErrorState 
  message="åŠ è½½å¤±è´¥" 
  details={error} 
  onRetry={reload} 
/>
```

#### EmptyState - ç©ºçŠ¶æ€æç¤º

```typescript
import { EmptyState } from '../../common';

<EmptyState 
  title="æ— å¯ç”¨æ•°æ®" 
  description="è¯·å…ˆæ·»åŠ å‰ç½®å‘½ä»¤"
  icon="ğŸ“¦"  // å¯é€‰
/>
```

#### VectorInput - å‘é‡è¾“å…¥

```typescript
import { Vector2Input, Vector3Input } from '../../common';

// 2D å‘é‡
<Vector2Input
  value={{ x: 0, y: 0 }}
  onChange={setPosition}
  step={0.01}
  labels={{ x: 'Xè½´', y: 'Yè½´' }}  // å¯é€‰
/>

// 3D å‘é‡
<Vector3Input
  value={{ x: 0, y: 0, z: 0 }}
  onChange={setRotation}
  step={0.1}
  labels={{ x: 'X (åº¦)', y: 'Y (åº¦)', z: 'Z (åº¦)' }}
/>
```

---

## ç¼–è¾‘å™¨å¼€å‘ä¸‰å¤§æ¨¡å¼

æ ¹æ®å‘½ä»¤çš„å¤æ‚åº¦ï¼Œç¼–è¾‘å™¨åˆ†ä¸ºä¸‰ç§å®ç°æ¨¡å¼ï¼š

### ğŸ“‹ æ¨¡å¼ä¸€ï¼šç®€å•å‚æ•°ç¼–è¾‘å™¨ï¼ˆæ¨èç”¨ FormEditorï¼‰

**é€‚ç”¨åœºæ™¯ï¼š**
- å‘½ä»¤åªæœ‰ç®€å•çš„æ–‡æœ¬ã€æ•°å­—ã€ä¸‹æ‹‰é€‰æ‹©ç­‰å‚æ•°
- å‚æ•°ç›´æ¥å­˜å‚¨åœ¨ `params` å¯¹è±¡ä¸­
- ä¸æ¶‰åŠåµŒå¥—ç»“æ„æˆ– JSON åºåˆ—åŒ–

**ä»£è¡¨å‘½ä»¤ï¼š** `dialogue`, `message`, `narration`, `fade`, `transition`

**å®ç°æ¨¡æ¿ï¼š**

```typescript
import React, { useState, useEffect } from 'react';
import { CommandCard } from '../../types/command';
import { FormEditor, FormSection } from '../FormEditor';

interface YourEditorProps {
  card: CommandCard;
  onChange: (updatedCard: CommandCard, isValid?: boolean) => void;
}

export const YourEditor: React.FC<YourEditorProps> = ({ card, onChange }) => {
  const [formData, setFormData] = useState(card);

  // å®šä¹‰è¡¨å•ç»“æ„
  const sections: FormSection[] = [
    {
      title: 'åŸºæœ¬è®¾ç½®',
      fields: [
        {
          name: 'id',
          label: 'ID',
          type: 'text',
          required: true,
          value: formData.params.id || '',
        },
        {
          name: 'value',
          label: 'æ•°å€¼',
          type: 'number',
          value: formData.params.value || 0,
          min: 0,
          max: 100,
        },
      ],
    },
  ];

  // å­—æ®µå˜åŒ–å¤„ç†
  const handleFieldChange = (fieldName: string, value: any) => {
    const updatedCard = {
      ...formData,
      params: {
        ...formData.params,
        [fieldName]: value,
      },
    };
    setFormData(updatedCard);
  };

  // å®æ—¶åŒæ­¥åˆ°çˆ¶ç»„ä»¶
  useEffect(() => {
    // éªŒè¯å¿…å¡«å­—æ®µ
    const isValid = formData.params.id !== undefined && formData.params.id !== '';
    onChange(formData, isValid);
  }, [formData]);

  return <FormEditor sections={sections} onChange={handleFieldChange} />;
};
```

**å…³é”®ç‚¹ï¼š**
- âœ… ä½¿ç”¨ FormEditor ç»Ÿä¸€ UI
- âœ… å®æ—¶éªŒè¯å’ŒåŒæ­¥ï¼ˆuseEffect + onChangeï¼‰
- âœ… é€šè¿‡ç¬¬äºŒä¸ªå‚æ•° `isValid` æ§åˆ¶ä¿å­˜æŒ‰é’®çŠ¶æ€
- âœ… æ¸…æ™°çš„å­—æ®µå®šä¹‰ï¼ˆæ”¯æŒ text, number, select, textarea ç­‰ï¼‰

**æ¡ä»¶å‚æ•°å¤„ç†ï¼š**

å¦‚æœæŸäº›å‚æ•°æ ¹æ®å…¶ä»–å‚æ•°åŠ¨æ€æ˜¾ç¤º/éšè—ï¼ˆå¦‚ `transition` å‘½ä»¤ï¼‰ï¼š

```typescript
const handleFieldChange = (fieldName: string, value: any) => {
  const updatedParams = { ...formData.params };
  
  // æ›´æ–°å­—æ®µ
  updatedParams[fieldName] = value;
  
  // æ¡ä»¶é€»è¾‘ï¼šæ ¹æ® type å†³å®šæ˜¯å¦éœ€è¦ character
  if (fieldName === 'type') {
    if (value === 'event_change') {
      // event ç±»å‹ä¸éœ€è¦ character
      delete updatedParams.character;
    } else {
      // é event ç±»å‹éœ€è¦ characterï¼ˆé»˜è®¤ç©ºï¼Œç­‰å¾…ç”¨æˆ·å¡«å†™ï¼‰
      if (!updatedParams.character) {
        updatedParams.character = '';
      }
    }
  }
  
  const updatedCard = { ...formData, params: updatedParams };
  setFormData(updatedCard);
};

// åœ¨ sections ä¸­ä½¿ç”¨ disabled æ§åˆ¶
{
  name: 'character',
  label: 'è§’è‰²',
  type: 'select',
  options: characters,
  value: formData.params.character || '',
  disabled: formData.params.type === 'event_change',  // æ¡ä»¶ç¦ç”¨
  required: formData.params.type !== 'event_change',  // æ¡ä»¶å¿…å¡«
}
```

---

### ğŸ”§ æ¨¡å¼äºŒï¼šGroup é¡¹ç¼–è¾‘å™¨ï¼ˆéœ€è¦ Database APIï¼‰

**é€‚ç”¨åœºæ™¯ï¼š**
- å‘½ä»¤åŒ…å«å¤šä¸ªå­é¡¹ï¼ˆå¦‚å¤šä¸ªèƒŒæ™¯ã€å¤šä¸ªè§’è‰²ï¼‰
- éœ€è¦å•ç‹¬ç¼–è¾‘ã€æ·»åŠ ã€åˆ é™¤å­é¡¹
- å­é¡¹æ ¼å¼ä¸º `[itemtype ...]` çš„åµŒå¥—ç»“æ„

**ä»£è¡¨å‘½ä»¤ï¼š** `backgroundgroup`, `actorgroup`, `actorlayoutgroup`, `backgroundlayoutgroup`

**æ¶æ„ç»„æˆï¼š**

```
1. Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰ - æ˜¾ç¤ºæ‰€æœ‰å­é¡¹ + ç¼–è¾‘/æ·»åŠ æŒ‰é’®
2. ItemEditorï¼ˆå­é¡¹ç¼–è¾‘å™¨ï¼‰ - ç¼–è¾‘å•ä¸ªå­é¡¹çš„è¡¨å•
3. App.tsx å¤„ç†é€»è¾‘ - ç»Ÿä¸€çš„ç¼–è¾‘/æ·»åŠ /ä¿å­˜é€»è¾‘
```

**å®Œæ•´å®ç°æµç¨‹ï¼š**

#### æ­¥éª¤ 1: åˆ›å»ºå­é¡¹ç¼–è¾‘å™¨

```typescript
// src/components/CommandEditors/BackgroundItemEditor/BackgroundItemEditor.tsx
import React, { useState, useEffect } from 'react';
import { useEnvironments } from '../../../hooks/useResourceAPI';
import { LoadingState, ErrorState } from '../../common';

interface BackgroundItemEditorProps {
  id: string;
  src: string;
  onChange: (data: { id: string; src: string }) => void;
}

export const BackgroundItemEditor: React.FC<BackgroundItemEditorProps> = ({
  id,
  src,
  onChange,
}) => {
  const [localData, setLocalData] = useState({ id, src });
  const { data: environments, loading, error, reload } = useEnvironments();

  // å®æ—¶åŒæ­¥åˆ°çˆ¶ç»„ä»¶
  useEffect(() => {
    onChange(localData);
  }, [localData]);

  if (loading) return <LoadingState message="åŠ è½½ç¯å¢ƒèµ„æº..." />;
  if (error) return <ErrorState message="åŠ è½½å¤±è´¥" details={error} onRetry={reload} />;

  return (
    <div className="background-item-editor">
      <div className="form-field">
        <label>èƒŒæ™¯ID</label>
        <input
          type="text"
          value={localData.id}
          onChange={(e) => setLocalData({ ...localData, id: e.target.value })}
          placeholder="ä¾‹å¦‚: bg_stage"
        />
      </div>
      <div className="form-field">
        <label>ç¯å¢ƒèµ„æº</label>
        <select
          value={localData.src}
          onChange={(e) => setLocalData({ ...localData, src: e.target.value })}
        >
          <option value="">è¯·é€‰æ‹©...</option>
          {environments?.map((env) => (
            <option key={env.id} value={env.src}>
              {env.name}
            </option>
          ))}
        </select>
      </div>
    </div>
  );
};
```

**å…³é”®ç‚¹ï¼š**
- âœ… ä½¿ç”¨ useResourceAPI åŠ è½½èµ„æº
- âœ… æ˜¾ç¤º LoadingState å’Œ ErrorState
- âœ… é€šè¿‡ useEffect å®æ—¶åŒæ­¥æ•°æ®åˆ°çˆ¶ç»„ä»¶
- âœ… éªŒè¯åœ¨çˆ¶ç»„ä»¶ï¼ˆApp.tsxï¼‰ä¸­ç»Ÿä¸€å¤„ç†

#### æ­¥éª¤ 2: åˆ›å»ºæ¸²æŸ“å™¨ï¼ˆæ”¯æŒç¼–è¾‘å’Œæ·»åŠ ï¼‰

```typescript
// src/renderers/BackgroundGroupRenderer.tsx
import React from 'react';
import { RendererProps } from './index';
import { ParamCard } from './ParamRow';
import { AddItemButton } from './ParamRow';

const BackgroundGroupRenderer: React.FC<RendererProps> = ({ 
  params, 
  onEditItem,   // ç¼–è¾‘æŸä¸ªå­é¡¹
  onAddItem     // æ·»åŠ æ–°å­é¡¹
}) => {
  const backgrounds = parseBackgroundGroup(params);
  
  return (
    <>
      {backgrounds.map((bg, index) => (
        <ParamCard 
          key={index} 
          title="èƒŒæ™¯è®¾ç½®"
          index={backgrounds.length > 1 ? index + 1 : undefined}  // å¤šä¸ªæ—¶æ˜¾ç¤ºåºå·
          onEdit={onEditItem ? () => onEditItem(index) : undefined}
        >
          <ParamRow label="èƒŒæ™¯ID" value={bg.id} />
          <ParamRow label="ç¯å¢ƒèµ„æº" value={bg.src} />
        </ParamCard>
      ))}
      
      {/* æ·»åŠ æŒ‰é’® */}
      {onAddItem && <AddItemButton label="æ·»åŠ èƒŒæ™¯" onClick={onAddItem} />}
    </>
  );
};

export default BackgroundGroupRenderer;
```

**å…³é”®ç‚¹ï¼š**
- âœ… ä½¿ç”¨ `onEditItem` å›è°ƒå¤„ç†ç¼–è¾‘
- âœ… ä½¿ç”¨ `onAddItem` å›è°ƒå¤„ç†æ·»åŠ 
- âœ… ä½¿ç”¨ `AddItemButton` ç»Ÿä¸€çš„æ·»åŠ æŒ‰é’®æ ·å¼
- âœ… å¤šä¸ªå­é¡¹æ—¶æ˜¾ç¤ºåºå·ï¼ˆ`index` propï¼‰

#### æ­¥éª¤ 3: åœ¨ App.tsx ä¸­æ·»åŠ å¤„ç†é€»è¾‘

**3.1 åœ¨ `handleEditGroupItem` ä¸­æ·»åŠ ç±»å‹ï¼š**

```typescript
const handleEditGroupItem = (card: CommandCard, itemIndex: number, itemType: string) => {
  const { parseBackgroundGroup, parseActorGroup } = require('./renderers/parserHelpers');
  
  if (itemType === 'background') {
    const backgrounds = parseBackgroundGroup(card.params);
    if (itemIndex >= 0 && itemIndex < backgrounds.length) {
      const bg = backgrounds[itemIndex];
      setEditingCard(card);
      setEditingItemIndex(itemIndex);
      setEditingItemData({ id: bg.id || '', src: bg.src || '' });
    }
  } 
  // else if (itemType === 'actor') { ... }
  // ä¸ºä½ çš„æ–°ç±»å‹æ·»åŠ ç±»ä¼¼çš„é€»è¾‘
};
```

**3.2 åœ¨ `handleAddGroupItem` ä¸­æ·»åŠ é»˜è®¤å€¼ï¼š**

```typescript
const handleAddGroupItem = (card: CommandCard, itemType: string) => {
  setEditingCard(card);
  setEditingItemIndex(-2);  // -2 è¡¨ç¤ºæ·»åŠ æ¨¡å¼
  
  if (itemType === 'background') {
    setEditingItemData({ id: '', src: '' });
  }
  // else if (itemType === 'actor') { ... }
};
```

**3.3 åœ¨ `handleSaveGroupItem` ä¸­æ·»åŠ ä¿å­˜é€»è¾‘ï¼š**

```typescript
const handleSaveGroupItem = () => {
  if (!editingCard) return;
  
  if (editingCard.type === 'backgroundgroup') {
    saveBackgroundGroupItem();
  }
  // else if (editingCard.type === 'actorgroup') { ... }
};

const saveBackgroundGroupItem = () => {
  const { parseBackgroundGroup } = require('./renderers/parserHelpers');
  const backgrounds = parseBackgroundGroup(editingCard.params);
  
  // æ·»åŠ æˆ–æ›´æ–°
  if (editingItemIndex === -2) {
    backgrounds.push(editingItemData);  // æ·»åŠ æ–°é¡¹
  } else if (editingItemIndex >= 0) {
    backgrounds[editingItemIndex] = editingItemData;  // æ›´æ–°ç°æœ‰é¡¹
  }
  
  // é‡å»ºå‘½ä»¤æ–‡æœ¬
  const backgroundsText = backgrounds
    .map(bg => `[background id=${bg.id} src=${bg.src}]`)
    .join(' ');
  
  const newRawLine = `[backgroundgroup backgrounds=${backgroundsText}]`;
  
  // æ›´æ–°å¡ç‰‡
  const updatedCard = {
    ...editingCard,
    raw_line: newRawLine,
    params: { backgrounds: backgroundsText },
    title: generateCardTitle(editingCard.type, { backgrounds: backgroundsText }),
  };
  
  // æ›´æ–° cards åˆ—è¡¨
  const newCards = cards.map(c => c.id === updatedCard.id ? updatedCard : c);
  setCards(newCards);
  
  // æ¸…ç†çŠ¶æ€
  setEditingCard(null);
  setEditingItemIndex(-1);
  setEditingItemData(null);
};
```

**3.4 åœ¨ `renderCommandDetails` ä¸­æ·»åŠ å›è°ƒï¼š**

```typescript
if (card.type === 'backgroundgroup') {
  props.onEditItem = (index: number) => handleEditGroupItem(card, index, 'background');
  props.onAddItem = () => handleAddGroupItem(card, 'background');
}
// else if (card.type === 'actorgroup') { ... }
```

**3.5 åœ¨ `getItemTypeName` ä¸­æ·»åŠ æ˜¾ç¤ºåç§°ï¼š**

```typescript
const getItemTypeName = (commandType: string): string => {
  const typeNames: Record<string, string> = {
    'backgroundgroup': 'èƒŒæ™¯è®¾ç½®',
    'actorgroup': 'è§’è‰²è®¾ç½®',
    // ä¸ºä½ çš„æ–°ç±»å‹æ·»åŠ 
  };
  return typeNames[commandType] || 'é¡¹';
};
```

**3.6 åœ¨ `renderGroupItemEditor` ä¸­æ·»åŠ ç¼–è¾‘å™¨ï¼š**

```typescript
const renderGroupItemEditor = (commandType: string) => {
  if (commandType === 'backgroundgroup') {
    return (
      <BackgroundItemEditor
        id={editingItemData.id || ''}
        src={editingItemData.src || ''}
        onChange={(data) => setEditingItemData(data)}
      />
    );
  }
  // else if (commandType === 'actorgroup') { ... }
  return null;
};
```

---

### ğŸ¯ æ¨¡å¼ä¸‰ï¼šå¤æ‚ JSON å‚æ•°ç¼–è¾‘å™¨

**é€‚ç”¨åœºæ™¯ï¼š**
- å‚æ•°æ˜¯å¤æ‚çš„åµŒå¥— JSON ç»“æ„
- éœ€è¦ JSON åºåˆ—åŒ–/ååºåˆ—åŒ–
- å¯èƒ½éœ€è¦è½¬ä¹‰å¤„ç†ï¼ˆå¦‚ `\{...\}`ï¼‰

**ä»£è¡¨å‘½ä»¤ï¼š** `camerasetting`, `backgroundsetting`ï¼ˆå¸¦ setting JSONï¼‰

**å®ç°æ¨¡æ¿ï¼š**

```typescript
import React, { useState, useEffect } from 'react';
import { CommandCard } from '../../types/command';
import { Vector3Input } from '../common';

interface YourEditorProps {
  card: CommandCard;
  onChange: (updatedCard: CommandCard, isValid?: boolean) => void;
}

export const YourEditor: React.FC<YourEditorProps> = ({ card, onChange }) => {
  // è§£æç°æœ‰çš„ JSON å‚æ•°
  const parseJsonParam = (paramValue: string | undefined): any => {
    if (!paramValue) return { /* é»˜è®¤å€¼ */ };
    try {
      // å¤„ç†è½¬ä¹‰çš„ JSONï¼ˆå¦‚æœéœ€è¦ï¼‰
      const unescaped = paramValue.replace(/\\{/g, '{').replace(/\\}/g, '}');
      return JSON.parse(unescaped);
    } catch {
      return { /* é»˜è®¤å€¼ */ };
    }
  };

  const [setting, setSetting] = useState(parseJsonParam(card.params.setting));

  // åºåˆ—åŒ–å¹¶åŒæ­¥åˆ°çˆ¶ç»„ä»¶
  useEffect(() => {
    const jsonString = JSON.stringify(setting);
    // å¦‚æœéœ€è¦è½¬ä¹‰
    const escaped = jsonString.replace(/{/g, '\\{').replace(/}/g, '\\}');
    
    const updatedCard = {
      ...card,
      params: {
        ...card.params,
        setting: escaped,
      },
    };
    onChange(updatedCard, true);
  }, [setting]);

  return (
    <div className="your-editor">
      <Vector3Input
        value={setting.position || { x: 0, y: 0, z: 0 }}
        onChange={(pos) => setSetting({ ...setting, position: pos })}
        labels={{ x: 'Xè½´', y: 'Yè½´', z: 'Zè½´' }}
      />
      {/* å…¶ä»–å­—æ®µ */}
    </div>
  );
};
```

**å…³é”®ç‚¹ï¼š**
- âœ… ä½¿ç”¨ try-catch å®‰å…¨è§£æ JSON
- âœ… æä¾›åˆç†çš„é»˜è®¤å€¼
- âœ… æ ¹æ®éœ€è¦å¤„ç†è½¬ä¹‰ï¼ˆ`\{` â†’ `{`ï¼‰
- âœ… ä½¿ç”¨ Vector3Input ç­‰ä¸“ç”¨ç»„ä»¶
- âœ… å®æ—¶åºåˆ—åŒ–å¹¶åŒæ­¥

---

## å¼€å‘æµç¨‹è§„èŒƒ

### æ–°å¢ç¼–è¾‘å™¨çš„å®Œæ•´æµç¨‹

#### 1. åˆ†æå‘½ä»¤ç±»å‹

**é—®é¢˜æ¸…å•ï¼š**
- [ ] å‘½ä»¤æœ‰å“ªäº›å‚æ•°ï¼Ÿ
- [ ] å‚æ•°æ˜¯ç®€å•ç±»å‹è¿˜æ˜¯å¤æ‚ç±»å‹ï¼ˆJSONï¼‰ï¼Ÿ
- [ ] æ˜¯å¦éœ€è¦ä» Database API è·å–èµ„æºï¼Ÿ
- [ ] æ˜¯å¦éœ€è¦ä»å…¶ä»–å‘½ä»¤è·å– ID åˆ—è¡¨ï¼Ÿ
- [ ] æ˜¯å¦æ˜¯ Group ç±»å‹å‘½ä»¤ï¼Ÿ
- [ ] æ˜¯å¦éœ€è¦å‘é‡è¾“å…¥ï¼Ÿ

**æ ¹æ®ç­”æ¡ˆé€‰æ‹©æ¨¡å¼ï¼š**
- ç®€å•å‚æ•° + æ— å¤–éƒ¨ä¾èµ– â†’ æ¨¡å¼ä¸€ï¼ˆç®€å•ï¼‰
- ç®€å•å‚æ•° + éœ€è¦ API/ID â†’ æ¨¡å¼ä¸€ï¼ˆé«˜çº§ï¼‰
- Group å‘½ä»¤ â†’ æ¨¡å¼äºŒ
- å¤æ‚ JSON å‚æ•° â†’ æ¨¡å¼ä¸‰

#### 2. åˆ›å»ºç¼–è¾‘å™¨æ–‡ä»¶

```bash
# æ¨¡å¼ä¸€
src/components/CommandEditors/YourEditor/YourEditor.tsx

# æ¨¡å¼äºŒï¼ˆéœ€è¦ä¸¤ä¸ªæ–‡ä»¶ï¼‰
src/components/CommandEditors/YourItemEditor/YourItemEditor.tsx
src/renderers/YourGroupRenderer.tsx
```

#### 3. å®ç°ç¼–è¾‘å™¨é€»è¾‘

**ä½¿ç”¨åŸºç¡€è®¾æ–½ï¼š**
- [ ] ä½¿ç”¨ `useEditorContext` æ›¿ä»£ window å¯¹è±¡
- [ ] ä½¿ç”¨ `useResourceAPI` åŠ è½½èµ„æº
- [ ] ä½¿ç”¨ `useAvailableIds` è·å– ID åˆ—è¡¨
- [ ] ä½¿ç”¨ `LoadingState` / `ErrorState` / `EmptyState`
- [ ] ä½¿ç”¨ `Vector2Input` / `Vector3Input`ï¼ˆå¦‚æœéœ€è¦ï¼‰

**éªŒè¯é€»è¾‘ï¼š**
- [ ] é€šè¿‡ `onChange(card, isValid)` æ§åˆ¶ä¿å­˜æŒ‰é’®
- [ ] å¿…å¡«å­—æ®µä¸èƒ½ä¸ºç©º
- [ ] æ•°å€¼èŒƒå›´éªŒè¯
- [ ] æ¡ä»¶å¿…å¡«ï¼ˆå¦‚ transition çš„ characterï¼‰

#### 4. æ›´æ–° App.tsx

**æ¨¡å¼ä¸€ï¼š**
- [ ] åœ¨ `renderEditorForType` ä¸­æ·»åŠ  case

**æ¨¡å¼äºŒï¼š**
- [ ] åœ¨ `handleEditGroupItem` ä¸­æ·»åŠ è§£æé€»è¾‘
- [ ] åœ¨ `handleAddGroupItem` ä¸­æ·»åŠ é»˜è®¤å€¼
- [ ] åœ¨ `handleSaveGroupItem` ä¸­æ·»åŠ ä¿å­˜é€»è¾‘
- [ ] åœ¨ `renderCommandDetails` ä¸­æ·»åŠ å›è°ƒ
- [ ] åœ¨ `getItemTypeName` ä¸­æ·»åŠ åç§°
- [ ] åœ¨ `renderGroupItemEditor` ä¸­æ·»åŠ ç¼–è¾‘å™¨

#### 5. åˆ›å»ºæ¸²æŸ“å™¨

```bash
src/renderers/YourRenderer.tsx
```

**å¿…é¡»å®ç°ï¼š**
- [ ] æ˜¾ç¤ºæ‰€æœ‰å‚æ•°
- [ ] ä½¿ç”¨ `ParamCard` å’Œ `ParamRow`
- [ ] æä¾› `onEdit` å›è°ƒï¼ˆæ¨¡å¼ä¸€ï¼‰æˆ– `onEditItem` / `onAddItem`ï¼ˆæ¨¡å¼äºŒï¼‰
- [ ] æ¡ä»¶æ¸²æŸ“ï¼ˆå¦‚ event ç±»å‹éšè— characterï¼‰

#### 6. æ›´æ–°å¡ç‰‡æ ‡é¢˜

åœ¨ `command-card.ts` çš„ `generateCardTitle` ä¸­æ·»åŠ  caseï¼š

```typescript
case 'yourcommand':
  return `å‘½ä»¤æ ‡é¢˜: ${params.key1} - ${params.key2}`;
```

#### 7. æµ‹è¯•

**å¿…æµ‹é¡¹ç›®ï¼š**
- [ ] åŠ è½½ç°æœ‰å‘½ä»¤æ­£å¸¸æ˜¾ç¤º
- [ ] ç¼–è¾‘å‚æ•°åä¿å­˜æˆåŠŸ
- [ ] åŸå§‹å‘½ä»¤æ–‡æœ¬æ­£ç¡®æ›´æ–°
- [ ] å¡ç‰‡æ ‡é¢˜æ­£ç¡®æ›´æ–°
- [ ] åŠ è½½çŠ¶æ€æ­£å¸¸æ˜¾ç¤º
- [ ] é”™è¯¯çŠ¶æ€ + é‡è¯•æŒ‰é’®æ­£å¸¸å·¥ä½œ
- [ ] ç©ºçŠ¶æ€æ­£å¸¸æ˜¾ç¤ºï¼ˆå¦‚æœé€‚ç”¨ï¼‰
- [ ] éªŒè¯é€»è¾‘æ­£ç¡®ï¼ˆä¿å­˜æŒ‰é’®ç¦ç”¨/å¯ç”¨ï¼‰
- [ ] æ¡ä»¶å‚æ•°æ­£ç¡®å¤„ç†ï¼ˆå¦‚æœé€‚ç”¨ï¼‰

---

## æœ€ä½³å®è·µå’Œæ³¨æ„äº‹é¡¹

### âœ… åº”è¯¥åšçš„

1. **ä½¿ç”¨åŸºç¡€è®¾æ–½**
   - âœ… æ‰€æœ‰ API è°ƒç”¨ä½¿ç”¨ `useResourceAPI`
   - âœ… æ‰€æœ‰ ID è·å–ä½¿ç”¨ `useAvailableIds`
   - âœ… æ‰€æœ‰çŠ¶æ€æ˜¾ç¤ºä½¿ç”¨é€šç”¨ç»„ä»¶
   - âœ… æ‰€æœ‰å‘é‡è¾“å…¥ä½¿ç”¨ `VectorInput`

2. **çŠ¶æ€ç®¡ç†**
   - âœ… ä½¿ç”¨ `useState` ç®¡ç†æœ¬åœ°è¡¨å•æ•°æ®
   - âœ… ä½¿ç”¨ `useEffect` å®æ—¶åŒæ­¥åˆ°çˆ¶ç»„ä»¶
   - âœ… é€šè¿‡ `onChange(card, isValid)` æ§åˆ¶ä¿å­˜æŒ‰é’®

3. **ç±»å‹å®‰å…¨**
   - âœ… ä¸ºæ‰€æœ‰ç»„ä»¶å®šä¹‰ Props æ¥å£
   - âœ… ä½¿ç”¨ TypeScript ç±»å‹æ¨å¯¼
   - âœ… é¿å…ä½¿ç”¨ `any`

4. **ç”¨æˆ·ä½“éªŒ**
   - âœ… æ˜¾ç¤ºæ¸…æ™°çš„åŠ è½½çŠ¶æ€
   - âœ… æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯
   - âœ… æä¾›é‡è¯•æŒ‰é’®
   - âœ… æ˜¾ç¤ºæœ‰æ„ä¹‰çš„ç©ºçŠ¶æ€æç¤º

5. **ä»£ç ç»„ç»‡**
   - âœ… ä¸€ä¸ªç¼–è¾‘å™¨ä¸€ä¸ªæ–‡ä»¶å¤¹
   - âœ… ä½¿ç”¨æ¸…æ™°çš„æ–‡ä»¶å‘½å
   - âœ… å¯¼å‡º index.ts ç»Ÿä¸€æ¥å£

### âŒ ä¸åº”è¯¥åšçš„

1. **ç¦æ­¢çš„æ¨¡å¼**
   - âŒ ä½¿ç”¨ `window` å¯¹è±¡ä¼ é€’æ•°æ®
   - âŒ ç›´æ¥ä¿®æ”¹ propsï¼ˆå§‹ç»ˆåˆ›å»ºæ–°å¯¹è±¡ï¼‰
   - âŒ åœ¨ç¼–è¾‘å™¨ä¸­ç›´æ¥è°ƒç”¨ `setCards`
   - âŒ ç¡¬ç¼–ç  API URLï¼ˆä½¿ç”¨ `useResourceAPI`ï¼‰

2. **é¿å…é‡å¤**
   - âŒ å¤åˆ¶ç²˜è´´ç°æœ‰ç¼–è¾‘å™¨ä»£ç 
   - âŒ é‡æ–°å®ç°å·²æœ‰çš„ API è°ƒç”¨é€»è¾‘
   - âŒ é‡æ–°å®ç°å·²æœ‰çš„å‘é‡è¾“å…¥ UI
   - âŒ é‡æ–°å®ç°å·²æœ‰çš„åŠ è½½/é”™è¯¯çŠ¶æ€

3. **ä¸å¥½çš„å®è·µ**
   - âŒ å¿½ç•¥é”™è¯¯å¤„ç†
   - âŒ å¿½ç•¥åŠ è½½çŠ¶æ€
   - âŒ å¿½ç•¥éªŒè¯é€»è¾‘
   - âŒ å¿½ç•¥æ¡ä»¶å‚æ•°çš„å¤„ç†

### âš ï¸ å¸¸è§é™·é˜±

1. **æ¡ä»¶å‚æ•°å¤„ç†**
   ```typescript
   // âŒ é”™è¯¯ï¼šåªè®¾ç½®å€¼ï¼Œä¸åˆ é™¤ä¸éœ€è¦çš„å‚æ•°
   if (type === 'event') {
     updatedParams.character = '';  // é”™è¯¯ï¼šåº”è¯¥åˆ é™¤
   }
   
   // âœ… æ­£ç¡®
   if (type === 'event') {
     delete updatedParams.character;
   } else {
     updatedParams.character = updatedParams.character || '';
   }
   ```

2. **JSON è½¬ä¹‰å¤„ç†**
   ```typescript
   // âŒ é”™è¯¯ï¼šå¿˜è®°è½¬ä¹‰
   params.setting = JSON.stringify(setting);
   
   // âœ… æ­£ç¡®
   const escaped = JSON.stringify(setting)
     .replace(/{/g, '\\{')
     .replace(/}/g, '\\}');
   params.setting = escaped;
   ```

3. **éªŒè¯æ—¶æœº**
   ```typescript
   // âŒ é”™è¯¯ï¼šåªåœ¨ä¿å­˜æ—¶éªŒè¯
   const handleSave = () => {
     if (!formData.id) {
       alert('ID ä¸èƒ½ä¸ºç©º');  // å¤ªæ™šäº†ï¼
     }
   };
   
   // âœ… æ­£ç¡®ï¼šå®æ—¶éªŒè¯
   useEffect(() => {
     const isValid = formData.id !== '' && formData.value > 0;
     onChange(formData, isValid);  // æ§åˆ¶ä¿å­˜æŒ‰é’®
   }, [formData]);
   ```

4. **ä¾èµ–éªŒè¯**
   ```typescript
   // âŒ é”™è¯¯ï¼šé™çº§åˆ°æ–‡æœ¬è¾“å…¥ï¼ˆç”¨æˆ·ä½“éªŒå·®ï¼‰
   if (availableIds.length === 0) {
     return <input type="text" />;  // ä¸å¥½
   }
   
   // âœ… æ­£ç¡®ï¼šæ˜¾ç¤ºæ¸…æ™°çš„æç¤º
   if (availableIds.length === 0) {
     return (
       <EmptyState 
         title="æ— å¯ç”¨è§’è‰²" 
         description="è¯·å…ˆæ·»åŠ  actorgroup å‘½ä»¤"
       />
     );
   }
   ```

---

## ä»£ç å®¡æŸ¥æ¸…å•

### æäº¤å‰è‡ªæŸ¥

#### åŸºç¡€æ£€æŸ¥
- [ ] ä»£ç æ²¡æœ‰ TypeScript é”™è¯¯
- [ ] æ²¡æœ‰ä½¿ç”¨ `window` å¯¹è±¡
- [ ] ä½¿ç”¨äº†é€‚å½“çš„åŸºç¡€è®¾æ–½ï¼ˆHooksã€ç»„ä»¶ï¼‰
- [ ] æ‰€æœ‰å¯¼å…¥è·¯å¾„æ­£ç¡®
- [ ] æ–‡ä»¶å‘½åç¬¦åˆè§„èŒƒ

#### åŠŸèƒ½æ£€æŸ¥
- [ ] ç¼–è¾‘å™¨èƒ½æ­£ç¡®åŠ è½½ç°æœ‰å‘½ä»¤
- [ ] ç¼–è¾‘å™¨èƒ½æ­£ç¡®ä¿å­˜ä¿®æ”¹
- [ ] åŸå§‹å‘½ä»¤æ–‡æœ¬æ­£ç¡®æ›´æ–°
- [ ] å¡ç‰‡æ ‡é¢˜æ­£ç¡®æ˜¾ç¤º
- [ ] éªŒè¯é€»è¾‘æ­£ç¡®ï¼ˆä¿å­˜æŒ‰é’®çŠ¶æ€ï¼‰

#### UI/UX æ£€æŸ¥
- [ ] æ˜¾ç¤ºåŠ è½½çŠ¶æ€
- [ ] æ˜¾ç¤ºé”™è¯¯çŠ¶æ€ + é‡è¯•æŒ‰é’®
- [ ] æ˜¾ç¤ºç©ºçŠ¶æ€ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
- [ ] å­—æ®µæ ‡ç­¾æ¸…æ™°æ˜“æ‡‚
- [ ] è¾“å…¥æ¡†æœ‰åˆç†çš„ placeholder
- [ ] å¿…å¡«å­—æ®µæœ‰æ ‡è®°

#### ä»£ç è´¨é‡
- [ ] æ²¡æœ‰é‡å¤ä»£ç ï¼ˆä¸ç°æœ‰ç¼–è¾‘å™¨å¯¹æ¯”ï¼‰
- [ ] ä½¿ç”¨äº†ç±»å‹å®šä¹‰
- [ ] å˜é‡å‘½åæ¸…æ™°
- [ ] é€»è¾‘æ¸…æ™°æ˜“æ‡‚
- [ ] æœ‰å¿…è¦çš„æ³¨é‡Š

---

## å¸¸è§é—®é¢˜è§£ç­”

### Q1: ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ FormEditorï¼Ÿ

**A:** å½“å‘½ä»¤å‚æ•°ç®€å•ã€ä¸éœ€è¦å¤æ‚çš„è‡ªå®šä¹‰ UI æ—¶ã€‚

**ä½¿ç”¨ FormEditorï¼š**
- âœ… åªæœ‰æ–‡æœ¬ã€æ•°å­—ã€ä¸‹æ‹‰é€‰æ‹©ç­‰ç®€å•å­—æ®µ
- âœ… ä¸éœ€è¦ Database API
- âœ… ä¸éœ€è¦å¤æ‚çš„çº§è”é€»è¾‘

**ä¸ä½¿ç”¨ FormEditorï¼š**
- âŒ éœ€è¦ä» Database API åŠ¨æ€åŠ è½½é€‰é¡¹
- âŒ éœ€è¦å¤æ‚çš„å‘é‡è¾“å…¥ï¼ˆä½¿ç”¨ VectorInputï¼‰
- âŒ éœ€è¦å¤æ‚çš„çº§è”é€»è¾‘ï¼ˆå¦‚ actorgroup çš„æ¨¡å‹é€‰æ‹©ï¼‰

### Q2: å¦‚ä½•åˆ¤æ–­æ˜¯å¦éœ€è¦ useAvailableIdsï¼Ÿ

**A:** å¦‚æœå‘½ä»¤éœ€è¦å¼•ç”¨å…¶ä»–å‘½ä»¤ä¸­å®šä¹‰çš„ IDï¼Œå°±ä½¿ç”¨ã€‚

**å…¸å‹åœºæ™¯ï¼š**
- `actormotion` / `actorfacialmotion` éœ€è¦ actor IDï¼ˆæ¥è‡ª `actorgroup`ï¼‰
- `backgroundsetting` éœ€è¦ background IDï¼ˆæ¥è‡ª `backgroundgroup`ï¼‰
- `actorlayoutgroup` éœ€è¦ actor IDï¼ˆæ¥è‡ª `actorgroup`ï¼‰

### Q3: ä»€ä¹ˆæ—¶å€™éœ€è¦æ˜¾ç¤º EmptyStateï¼Ÿ

**A:** å½“å‘½ä»¤å¼ºåˆ¶ä¾èµ–å…¶ä»–å‘½ä»¤çš„æ•°æ®æ—¶ã€‚

**ç¤ºä¾‹ï¼š**
```typescript
const availableActorIds = useAvailableActorIds();

if (availableActorIds.length === 0) {
  return (
    <EmptyState 
      title="æ— å¯ç”¨è§’è‰²" 
      description="è¯·å…ˆæ·»åŠ  actorgroup å‘½ä»¤æ¥å®šä¹‰è§’è‰²"
    />
  );
}
```

**ä¸è¦é™çº§åˆ°æ–‡æœ¬è¾“å…¥ï¼** è¿™ä¼šè®©ç”¨æˆ·è¾“å…¥é”™è¯¯çš„å€¼ã€‚

### Q4: å¦‚ä½•å¤„ç†æ¡ä»¶å‚æ•°ï¼Ÿ

**A:** åœ¨ `handleFieldChange` ä¸­æ ¹æ®æ¡ä»¶æ·»åŠ /åˆ é™¤å‚æ•°ã€‚

**å…³é”®ç‚¹ï¼š**
1. ä½¿ç”¨ `delete` åˆ é™¤ä¸éœ€è¦çš„å‚æ•°
2. åœ¨ä¿å­˜æ—¶æ£€æµ‹å‚æ•°æ•°é‡å˜åŒ–ï¼ˆè§¦å‘å®Œæ•´é‡å»ºï¼‰
3. åœ¨æ¸²æŸ“å™¨ä¸­æ¡ä»¶æ¸²æŸ“
4. åœ¨å¡ç‰‡æ ‡é¢˜ä¸­æ¡ä»¶æ˜¾ç¤º

å‚è€ƒ `TransitionEditor` çš„å®ç°ã€‚

### Q5: Group ç¼–è¾‘å™¨çš„æ·»åŠ å’Œç¼–è¾‘æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A:** é€šè¿‡ `editingItemIndex` åŒºåˆ†ï¼š

- `editingItemIndex === -2` â†’ æ·»åŠ æ¨¡å¼ï¼ˆæ–°å»ºé¡¹ï¼‰
- `editingItemIndex >= 0` â†’ ç¼–è¾‘æ¨¡å¼ï¼ˆä¿®æ”¹ç°æœ‰é¡¹ï¼‰

```typescript
if (editingItemIndex === -2) {
  items.push(editingItemData);  // æ·»åŠ 
} else if (editingItemIndex >= 0) {
  items[editingItemIndex] = editingItemData;  // æ›´æ–°
}
```

### Q6: å¦‚ä½•å¤„ç† JSON è½¬ä¹‰ï¼Ÿ

**A:** æ ¹æ®å‘½ä»¤æ ¼å¼å†³å®šæ˜¯å¦éœ€è¦è½¬ä¹‰ã€‚

**éœ€è¦è½¬ä¹‰ï¼ˆå¦‚ `camerasetting`ï¼‰ï¼š**
```typescript
const escaped = JSON.stringify(data)
  .replace(/{/g, '\\{')
  .replace(/}/g, '\\}');
```

**ä¸éœ€è¦è½¬ä¹‰ï¼ˆå¦‚ `backgroundsetting`ï¼‰ï¼š**
```typescript
const jsonString = JSON.stringify(data);  // ç›´æ¥ä½¿ç”¨
```

**åˆ¤æ–­æ–¹æ³•ï¼š** æŸ¥çœ‹åŸå§‹å‘½ä»¤æ–‡æœ¬ä¸­çš„æ ¼å¼ã€‚

### Q7: å¦‚ä½•å¤ç”¨ç±»ä¼¼çš„ç¼–è¾‘å™¨ï¼Ÿ

**A:** åˆ›å»ºé€šç”¨ç¼–è¾‘å™¨ + é…ç½®å‚æ•°ã€‚

**ç¤ºä¾‹ï¼š** `ActorResourceEditor` å¤ç”¨äº `actormotion` å’Œ `actorfacialmotion`

```typescript
// ActorResourceEditor.tsxï¼ˆé€šç”¨ï¼‰
interface ActorResourceEditorConfig {
  resourceType: 'character' | 'facial';
  resourceLabel: string;
  extraFields?: FormField[];
}

export const ActorResourceEditor: React.FC<Props & { config: Config }> = ({ 
  card, onChange, config 
}) => {
  // é€šç”¨é€»è¾‘
};

// ActorMotionEditor.tsxï¼ˆç‰¹åŒ–ï¼‰
export const ActorMotionEditor: React.FC<Props> = (props) => (
  <ActorResourceEditor 
    {...props} 
    config={{ resourceType: 'character', resourceLabel: 'åŠ¨ä½œåç§°' }} 
  />
);
```

### Q8: å¦‚ä½•æµ‹è¯•ç¼–è¾‘å™¨ï¼Ÿ

**A:** æ‰‹åŠ¨æµ‹è¯•æµç¨‹ï¼š

1. **åŠ è½½æµ‹è¯•**
   - æ‰“å¼€ç¤ºä¾‹æ–‡ä»¶ï¼ˆsample.txtï¼‰
   - æ‰¾åˆ°å¯¹åº”çš„å‘½ä»¤
   - ç‚¹å‡»ç¼–è¾‘æŒ‰é’®
   - ç¡®è®¤å‚æ•°æ­£ç¡®æ˜¾ç¤º

2. **ç¼–è¾‘æµ‹è¯•**
   - ä¿®æ”¹å„ä¸ªå‚æ•°
   - ç‚¹å‡»ä¿å­˜
   - ç¡®è®¤å¡ç‰‡æ ‡é¢˜æ›´æ–°
   - ç¡®è®¤åŸå§‹å‘½ä»¤æ–‡æœ¬æ›´æ–°

3. **éªŒè¯æµ‹è¯•**
   - æ¸…ç©ºå¿…å¡«å­—æ®µ
   - ç¡®è®¤ä¿å­˜æŒ‰é’®ç¦ç”¨
   - å¡«å†™å¿…å¡«å­—æ®µ
   - ç¡®è®¤ä¿å­˜æŒ‰é’®å¯ç”¨

4. **è¾¹ç•Œæµ‹è¯•**
   - æµ‹è¯•ç©ºå€¼
   - æµ‹è¯•æé™å€¼
   - æµ‹è¯•é”™è¯¯è¾“å…¥

5. **ä¾èµ–æµ‹è¯•**ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
   - åˆ é™¤å‰ç½®å‘½ä»¤ï¼ˆå¦‚ actorgroupï¼‰
   - ç¡®è®¤æ˜¾ç¤º EmptyState
   - é‡æ–°æ·»åŠ å‰ç½®å‘½ä»¤
   - ç¡®è®¤æ¢å¤æ­£å¸¸

---

## é™„å½•

### å¿«é€Ÿå‚è€ƒ

#### åŸºç¡€è®¾æ–½å¯¼å…¥

```typescript
// Context
import { useEditorContext, useEditorCards, useSelectedCard } from '../../../context/EditorContext';

// Hooks
import { useResourceAPI, useMotions, useEnvironments, useModels, useCharacters } from '../../../hooks/useResourceAPI';
import { useAvailableActorIds, useAvailableBackgroundIds, isBackground2D } from '../../../hooks/useAvailableIds';

// Components
import { LoadingState, ErrorState, EmptyState, Vector2Input, Vector3Input } from '../../common';
import { FormEditor, FormSection, FormField } from '../FormEditor';
import { ParamCard, ParamRow, AddItemButton } from '../../renderers/ParamRow';
```

#### å¸¸ç”¨ä»£ç ç‰‡æ®µ

**åŠ è½½èµ„æºï¼š**
```typescript
const { data: resources, loading, error, reload } = useMotions('character');

if (loading) return <LoadingState message="åŠ è½½èµ„æºä¸­..." />;
if (error) return <ErrorState message="åŠ è½½å¤±è´¥" details={error} onRetry={reload} />;
```

**æ£€æŸ¥ä¾èµ–ï¼š**
```typescript
const availableIds = useAvailableActorIds();

if (availableIds.length === 0) {
  return <EmptyState title="æ— å¯ç”¨è§’è‰²" description="è¯·å…ˆæ·»åŠ  actorgroup å‘½ä»¤" />;
}
```

**å®æ—¶éªŒè¯ï¼š**
```typescript
useEffect(() => {
  const isValid = formData.params.id !== '' && formData.params.value > 0;
  onChange(formData, isValid);
}, [formData]);
```

**å‘é‡è¾“å…¥ï¼š**
```typescript
<Vector3Input
  value={position}
  onChange={setPosition}
  step={0.01}
  labels={{ x: 'Xè½´', y: 'Yè½´', z: 'Zè½´' }}
/>
```

---

## æ€»ç»“

éµå¾ªæœ¬è§„èŒƒå¯ä»¥ç¡®ä¿ï¼š

- âœ… **ä»£ç ä¸€è‡´æ€§** - æ‰€æœ‰ç¼–è¾‘å™¨ä½¿ç”¨ç»Ÿä¸€çš„å®ç°æ¨¡å¼
- âœ… **é¿å…é‡å¤** - æœ€å¤§åŒ–å¤ç”¨åŸºç¡€è®¾æ–½
- âœ… **ç”¨æˆ·ä½“éªŒ** - ç»Ÿä¸€çš„ UI å’Œäº¤äº’
- âœ… **æ˜“äºç»´æŠ¤** - æ¸…æ™°çš„æ¶æ„å’Œæ–‡æ¡£
- âœ… **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰

**è®°ä½æ ¸å¿ƒåŸåˆ™ï¼š**
1. ä¸è¦é‡æ–°å‘æ˜è½®å­ - ä½¿ç”¨ç°æœ‰çš„åŸºç¡€è®¾æ–½
2. ä¿æŒä¸€è‡´æ€§ - å‚è€ƒç°æœ‰çš„æœ€ä½³å®è·µ
3. ä¼˜å…ˆç”¨æˆ·ä½“éªŒ - æ¸…æ™°çš„æç¤ºå’Œå‹å¥½çš„é”™è¯¯å¤„ç†

---

ğŸ“ **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
ğŸ“… **æœ€åæ›´æ–°**: 2026-01-13  
ğŸ‘¤ **ç»´æŠ¤è€…**: Editor2 å¼€å‘å›¢é˜Ÿ
